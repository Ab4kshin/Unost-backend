from app import app, db
from models import User, Group, PortfolioFile
from datetime import datetime

def init_test_data():
    """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö"""
    if not User.query.filter_by(email='admin@college.ru').first():
        admin = User(email='admin@college.ru', role='admin')
        admin.set_password('admin123')
        db.session.add(admin)
        print('‚úÖ –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: admin@college.ru / admin123')

    groups_data = [
        '–¢–ú-1417', '–ú–¶–ú-–ü—Ñ-102', '–¢–ò–ö-112', '–ò–°–ü-1308', '–°–ü-–ü—Ñ-1603', 
        '–¢–≠–∏–†–ü-1901', '–¢–ê–ö–•–°-–ü—Ñ-1202', '–ò–°–ü-1309–ø', '–¢–û–∏–†–ê-1701–ø', 
        '–ü–ö–î-1808–ø', '–¢–ú-1418–ø', '–°–ü-–ü—Ñ-1604–ø',
        '–¢–≠–û-–ü—Ñ-2501', '–ú–¶–ú-–ü—Ñ-201', '–°–ü-–ü—Ñ-2601', '–¢–ê–ö–•–°-–ü—Ñ-2201', 
        '–¢–û–†–î-2706', '–¢–ú-2415', '–ü–ö–î-2806/07–ø', '–°–ü-–ü—Ñ-2602–ø', 
        '–¢–û–†–î-2707–ø', '–¢–ú-2416–ø', '–ò–°–ü-2306–ø', '–ò–°–ü-2307–ø',
        '–¢–ê–ö–•–°-3202', '–°–ü-3611', '–¢–ú-3413', '–ú–¶–ú-308', '–ò–°–ü-3304', 
        '–û–°–ê-391', '–¢–ò–ö-311', '–ò–°–ü-3305–ø', '–¢–û–†–î-3705–ø', '–ü–ö–î-3805–ø', 
        '–°–ü-3612–ø', '–¢–ú-3414–ø',
        '–¢–ê–ö–•–°-4201', '–¢–≠–û-4510', '–°–ü-469', '–¢–û–†–î-4703', '–¢–ú-4412', 
        '–ú–¶–ú-407', '–ü–ö–î-4803', '–ò–°–ü-4303–ø', '–¢–û–†–î-4704–ø', '–°–ü-4610–ø', 
        '–ü–ö–î-4804–ø'
    ]
    
    for group_name in groups_data:
        if not Group.query.filter_by(name=group_name).first():
            group = Group(name=group_name)
            db.session.add(group)
            print(f'‚úÖ –°–æ–∑–¥–∞–Ω–∞ –≥—Ä—É–ø–ø–∞: {group_name}')

if __name__ == '__main__':
    with app.app_context():
        try:
            db.create_all()
            print("‚úÖ –¢–∞–±–ª–∏—Ü—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω—ã/–ø—Ä–æ–≤–µ—Ä–µ–Ω—ã")
            print("‚úÖ –í–∫–ª—é—á–∞—è —Ç–∞–±–ª–∏—Ü—É PortfolioFile –¥–ª—è –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ")
            
            init_test_data()
            db.session.commit()
            print("‚úÖ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã")
            
        except Exception as e:
            db.session.rollback()
            print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: {e}")
    
    print("üöÄ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ http://localhost:5000")
    app.run(debug=True, host='0.0.0.0', port=5000)